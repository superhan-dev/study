# 작성일

- 2025-12-08

# private 생성자나 열거타입으로 싱글턴임을 보증하라

## 싱글턴이란?

프로그램의 생명주기 동안 생성되는 인스턴스가 힙에 물리적으로 오직 한개만 존재하도록 설계하는 디자인 패턴을 싱글턴 패턴이라고 한다.

## 테스트가 어려워질 수 있다.

하지만 싱글턴으로 구현하면 테스트가 불편하게 될 수 있다. 그 이유는 테스트에서 mock 인스턴스를 사용해서 테스트를 구현할 수 없기 때문이다.

## 싱글턴을 만드는 방법

1. 생성자를 private으로 감춰두고 유일하게 접근 가능한 static 멤버를 정의한다.

```java
public class Elvis {
    public static final Elvis INSTANCE = new Elvis();

    private Elvis(){...}
}
```

이와 같이 정의를 해서 클래스가 초기화될때 하나의 인스턴스가 만들어진다.

2. 정적 팩터리 방식의 싱글턴

멤버 인스턴스도 private으로 만들고 정적팩터리 메서드를 통해 반환하는 방식도 있다.

```java
public class Elvis {
    private static final Elvis INSTANCE = new Elvis();
    private Elvis(){...}

    public static Elvis getInstance() { return INSTANCE; }
}
```

이와 같이 구현을 하면 Elvis.getInstance(); 를 통해 항상 같은 객체 참조를 반환할 수 있다.

3. 열거 타입을 선언하는것
   public 필드 방식과 비슷하지만 더 간결하고 추가 노력 없이 직렬화 할 수 있다

```java
public enum Elvis {
    INSTANCE;
    public void leaveTheBuilding(){...}
}

```

### enum도 인스턴스를 생성하나?

위에서 작성했던 코드를 다시 보자. 이 코드는 enum이지만 enum을 컴파일하면 final class를 생성한것과 같이 동작한다.

예를 들어

```java
public enum Elvis {
    INSTANCE;
    public void leaveTheBuilding(){...}
}
```

위와 같은 코드를 컴파일 한다면 다음과 같이 정의된다.

```java
public final class Elvis extends Enum<Elvis> {
    public static final Elvis INSTANCE = new Elvis();

    private Elvis() {
        super("INSTANCE", 0);
    }

    public void leaveTheBuilding() { ... }

    public static Elvis[] values() { ... }
    public static Elvis valueOf(String name) { ... }
}
```
