
# 6. ë°ì´í„° Feature ì„¤ê³„

## Feature TTL / ë²„ì „ ì „ëµ

ë°ì´í„° FeatureëŠ” ì‹œê°„ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ë•Œë¬¸ì— ì˜¤ë˜ëœ ë°ì´í„° FeatureëŠ” ì˜¤ë‹µìœ¼ë¡œ ì´ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ìˆë‹¤.
ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì„¤ê³„ ì›ì¹™ì„ ì •í•œë‹¤.

### ğŸ§± Feature ì„±ê²©ë³„ TTL

| Feature íƒ€ì…    | ì˜ˆì‹œ                | TTL    |
|-----------------|---------------------|--------|
| Seller ì²˜ë¦¬ì‹œê°„ | avg_fulfillment_sec | 6â€“24h  |
| Zip ì‹œê°„ëŒ€ ì†ë„ | zip hour avg speed  | 1â€“3h   |
| Route ë³‘ëª© ì ìˆ˜ | bottleneck_score    | 15â€“60m |
| ì •ì  Feature    | ë„ë¡œ ë“±ê¸‰ ë¹„ìœ¨      | ë¬´ì œí•œ |

### Redis Key ì„¤ê³„

í‚¤ ë³„ ì‹œê°„ê³¼ ë²„ì „ì„ í• ë‹¹í•´ ê´€ë¦¬í•œë‹¤. Feature ê³„ì‚° ë¡œì§ ë³€ê²½ ë° ëª¨ë¸ ë³€ê²½, í†µê³„ ë°©ì‹ ë³€ê²½ ë“± ë³€í™”ì— ëŒ€ì‘ ê°€ëŠ¥í•œ ì„¤ê³„ë¥¼ í•œë‹¤.

- vN = Feature ë²„ì „
- TTLì€ Key ë‹¨ìœ„ ì ìš©

```
seller:123:v2:avg_fulfillment_sec
zip:11001:hour:9:v3:avg_speed
route:R-991:v1:bottleneck_score
```

### ë²„ì „ ë³€ê²½ ê·œì¹™

ë²„ì „ì´ ë³€ê²½ë˜ë©´ ìƒˆë¡œìš´ Keyë¥¼ í• ë‹¹í•˜ê³  ê¸°ì¡´í‚¤ëŠ” ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤.(ìì—°íˆ TTLì— ë”°ë¼ ë§Œë£Œëœë‹¤.)

### ETA Engineì—ì„œ ì½ëŠ” ë°©ì‹

try v3
fallback v2
fallback baseline

>â€œFeatureëŠ” TTLê³¼ ë²„ì „ì„ í•¨ê»˜ ê´€ë¦¬í•´ì„œ
ì‹ ì„ ë„ì™€ ì¬í˜„ì„±ì„ ë™ì‹œì— ë³´ì¥í•©ë‹ˆë‹¤.â€

# 7. Redis ì¥ì•  ì‹œ ETA Fallback ì „ëµ

RedisëŠ” ì–¸ì œë“  ì£½ì„ ê°€ëŠ¥ì„±ì„ ê°€ì§€ë¯€ë¡œ fallback ê³„ì¸µêµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ì—¬ ì‹¤íŒ¨ì‹œë¥¼ ì¤€ë¹„í•œë‹¤.

### Fallback ê³„ì¸µ êµ¬ì¡°

```text
L1 Redis Feature
   â†“
L2 In-Memory Baseline
   â†“
L3 Static Rule
```

#### L1 ì‹¤íŒ¨ ì‹œ

- Redis timeout 20â€“50ms
- Circuit Breaker

#### L2 In-Memory
- í‰ê·  ì…€ëŸ¬ ì²˜ë¦¬ ì‹œê°„
- ê¸°ë³¸ Zip í‰ê· 
```
seller_avg = local_cache or global_avg
```

#### L3 Static Rule

ETA Engineì€ ë³´í†µ Redisì—ì„œ ì½ì€ Featureë¡œ ë¶€í„° í‰ê· ì†ë„, ì…€ëŸ¬ ì²˜ë¦¬ì‹œê°„, ë³‘ëª© ì ìˆ˜, Routing ê²°ê³¼ ë“±ì„ ì½ëŠ”ë‹¤.
í•˜ì§€ë§Œ Redisê°€ ì£½ê±°ë‚˜ Feature ë°ì´í„°ì— ì´ìƒì´ ì¡´ì¬í•˜ë©´

```
eta = distance_km / 40kmh + seller_baseline
```