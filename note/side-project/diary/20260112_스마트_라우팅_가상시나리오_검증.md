# [Project] 데이터 기반 Smart Routing 시스템 설계 전략

## 1. 사용 테이블

| 알고리즘 변수 | 관련 테이블               | 관련 컬럼                                        |
| ------------- | ------------------------- | ------------------------------------------------ |
| 고객 위치     | olist_customers_dataset   | customer_zip_code_prefix                         |
| 셀러 위치     | olist_sellers_dataset     | seller_zip_code_prefix                           |
| 재고 확인     | olist_inventory_dataset   | current_stock, reserved_stock                    |
| 물성 데이터   | olist_products_dataset    | product_weight_g, product_length_cm 등           |
| 운송 비용     | olist_order_items_dataset | freight_value                                    |
| 과거 성능     | olist_orders_dataset      | order_approved_at, order_delivered_customer_date |

## 2. 검증 SQL

```sql
-- 예시: 특정 상품에 대해 배송 가능한 셀러들의 스코어 산출 기초 데이터
SELECT
    i.seller_id,
    p.product_weight_g,
    AVG(o.order_delivered_customer_date - o.order_delivered_carrier_date) as avg_transit_time,
    PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY (o.order_delivered_customer_date - o.order_delivered_carrier_date)) as p90_transit_time,
    AVG(i.freight_value) as avg_freight
FROM olist_order_items_dataset i
JOIN olist_orders_dataset o ON i.order_id = o.order_id
JOIN olist_products_dataset p ON i.product_id = p.product_id
WHERE i.product_id = 'TARGET_PRODUCT_ID'
  AND EXISTS (SELECT 1 FROM olist_inventory_dataset inv WHERE inv.seller_id = i.seller_id AND inv.current_stock > 0)
GROUP BY i.seller_id, p.product_weight_g;
```

4. 추가 제언 (검증 결과 보완)설계하신 시스템의 완성도를 높이기 위해 SQL 수준에서 다음을 고려해보시면 좋습니다.지리적 거리 계산 추가: 현재 olist*geolocation_dataset에 위도/경도(lat, lng)가 있습니다. 단순 우편번호 매칭을 넘어 Haversine 공식을 SQL 함수로 구현하면 실제 물리적 거리를 계산하여 가중치에 정밀함을 더할 수 있습니다.실시간성 보완: olist_inventory_events 테이블을 통해 '최근 1시간 내 출고량' 등을 집계하면, 특정 셀러에게 주문이 몰려 출고 지연($T*{prep}$ 증가)이 예상되는 상황을 실시간 점수에 반영할 수 있습니다.데이터 무결성: init.sql에 이미 외래키(FK)와 인덱스가 잘 잡혀 있어 성능 면에서도 효율적일 것으로 보입니다.
